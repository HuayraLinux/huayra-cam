<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <style type="text/css">
        body, html{margin:0; padding:0; width:640px; height: 480px; overflow: hidden}
    </style>

</head>
<body>

    <video width="640" height="480" autoplay></video>
    <canvas width="640" height="480" style="display:none;"></canvas>

    <script>

        var path = '/Users/sergiovilar/Desktop'

        function gravaImagem(img){

            var fs = require('fs'),
                sys = require('sys');
            
            var data = img.replace(/^data:image\/\w+;base64,/, "");
            var buf = new Buffer(data, 'base64');
            fs.writeFile(path + '/' +new Date().getTime()+ '.png', buf);

            alert('Imagem salva!')

        }

        var errorCallback = function(e) {
            console.log('Reeeejected!', e);
        };

        var video = document.querySelector('video');
        var canvas = document.querySelector('canvas');
        var ctx = canvas.getContext('2d');
        var localMediaStream = null;

        function snapshot() {
            if (localMediaStream) {
              ctx.drawImage(video, 0, 0);          
              gravaImagem(canvas.toDataURL('image/png'));
            }
        }

        video.addEventListener('click', snapshot, false);
      
          navigator.webkitGetUserMedia({video: true}, function(stream) {
            video.src = window.URL.createObjectURL(stream);
            localMediaStream = stream;
        }, errorCallback);

      </script>

  </body>
  </html>
